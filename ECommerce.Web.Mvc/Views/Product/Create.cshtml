@model ECommerce.Web.Mvc.Models.Product.ProductCreateViewModel
@{
    ViewData["Title"] = "Create Product";
}

<section class="checkout profile-section">
    <div class="container">
        <div class="row">
            <!-- LEFT MENU -->
            <div class="col-lg-4 col-md-4">
                <div class="checkout__order profile-sidebar">
                    <h4>Account Menu</h4>
                    <ul class="list-group list-group-flush profile-menu">
                        <li class="list-group-item"><a href="/profile/details">My Profile</a></li>
                        <li class="list-group-item"><a href="/profile/edit">Edit Profile</a></li>
                        <li class="list-group-item"><a href="/profile/my-orders">My Orders</a></li>
                        <li class="list-group-item"><a href="/profile/my-products">My Products</a></li>
                    </ul>
                </div>
            </div>

            <!-- RIGHT CONTENT (FORM) -->
            <div class="col-lg-8 col-md-8">
                <div class="checkout__form profile-content">
                    <h4 class="mb-4">Create Product</h4>

                    @if (TempData["Error"] != null)
                    {
                        <div class="alert alert-danger">@TempData["Error"]</div>
                    }

                    <form asp-action="Create" method="post" enctype="multipart/form-data">
                        @Html.AntiForgeryToken()

                        <div class="form-group mb-3">
                            <label>Name<span class="text-danger">*</span></label>
                            <input type="text" class="form-control" asp-for="Name" required />
                            @Html.ValidationMessageFor(m => m.Name, "", new { @class = "text-danger" })
                        </div>

                        <div class="form-group mb-3">
                            <label>Category<span class="text-danger">*</span></label>
                            <select class="form-control" asp-for="CategoryId" asp-items="@(ViewData["Categories"] as List<SelectListItem>)">
                                <option value="">Select Category</option>
                            </select>
                            @Html.ValidationMessageFor(m => m.CategoryId, "", new { @class = "text-danger" })
                        </div>

                        <div class="form-group mb-3">
                            <label>Price<span class="text-danger">*</span></label>
                            <input type="number" class="form-control" asp-for="Price" min="0" step="0.01" required />
                            @Html.ValidationMessageFor(m => m.Price, "", new { @class = "text-danger" })
                        </div>

                        <div class="form-group mb-3">
                            <label>Old Price</label>
                            <input type="number" class="form-control" asp-for="OldPrice" min="0" step="0.01" />
                        </div>

                        <div class="form-group mb-3">
                            <label>Stock Amount<span class="text-danger">*</span></label>
                            <input type="number" class="form-control" asp-for="StockAmount" min="0" max="255" required />
                            @Html.ValidationMessageFor(m => m.StockAmount, "", new { @class = "text-danger" })
                        </div>

                        <div class="form-group mb-3">
                            <label>Details</label>
                            <textarea class="form-control" asp-for="Details" rows="4" placeholder="Describe your product..."></textarea>
                            @Html.ValidationMessageFor(m => m.Details, "", new { @class = "text-danger" })
                        </div>
                        <div class="form-group mb-3">
                            <label>Product Image Preview</label>
                            <div class="mb-2">
                                @* TagHelper kullanımı *@
                                <my-img file-name="@Model.ImageUrl"
                                        id="productPreview"
                                        class="img-thumbnail"
                                        style="max-width: 200px; display: block;" />
                            </div>

                            <label>Upload Image<span class="text-danger">*</span></label>
                            <div class="custom-file" style="overflow: hidden;">
                                <input type="file" name="ImageFile" class="custom-file-input" id="customFile" accept="image/*">
                                <label class="custom-file-label" for="customFile">Choose file...</label>
                            </div>

                            @* Create'de ImageUrl başlangıçta boş olabilir, ancak validasyon için tutulabilir *@
                            <input type="hidden" asp-for="ImageUrl" id="hiddenImageUrl" />
                            @Html.ValidationMessageFor(m => m.ImageUrl, "", new { @class = "text-danger" })
                        </div>

                        <button type="submit" class="site-btn">Create</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Dosya seçildiğinde etiketi değiştirir ve anlık önizleme yapar
        document.getElementById('customFile').addEventListener('change', function (e) {
            if (e.target.files.length > 0) {
                var file = e.target.files[0];

                // 1. Label ismini güncelle
                var fileName = file.name;
                var label = e.target.nextElementSibling;
                label.innerText = fileName;

                // 2. Anlık Önizleme (FileReader API)
                var reader = new FileReader();
                reader.onload = function(event) {
                    document.getElementById('productPreview').src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
    </script>
}
<style>
    .profile-menu li a {
        color: #111 !important;
        text-decoration: none;
    }

        .profile-menu li a:hover {
            color: #7fad39 !important;
        }

        .profile-menu li a.active {
            color: #111 !important;
            font-weight: bold;
        }

    .custom-file {
        position: relative;
        display: inline-block;
        width: 100%;
        margin-bottom: 0;
    }

    .custom-file-input {
        cursor: pointer;
    }
</style>